<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=US-ASCII">
<title>GstAdapter</title>
<meta name="generator" content="DocBook XSL Stylesheets V1.72.0">
<link rel="start" href="index.html" title="GStreamer 0.10 Library Reference Manual">
<link rel="up" href="gstreamer-base.html" title="GStreamer Base and Utillity Classes">
<link rel="prev" href="GstPushSrc.html" title="GstPushSrc">
<link rel="next" href="GstCollectPads.html" title="GstCollectPads">
<meta name="generator" content="GTK-Doc V1.8 (XML mode)">
<link rel="stylesheet" href="style.css" type="text/css">
<link rel="part" href="gstreamer-libs.html" title="Part&#160;I.&#160;GStreamer Libraries">
<link rel="chapter" href="gstreamer-base.html" title="GStreamer Base and Utillity Classes">
<link rel="chapter" href="gstreamer-control.html" title="GStreamer Dynamic Parameter Control">
<link rel="chapter" href="gstreamer-dataprotocol.html" title="GStreamer Data Protocol">
<link rel="chapter" href="gstreamer-net.html" title="GStreamer Network Classes">
<link rel="chapter" href="gstreamer-check.html" title="GStreamer Check Unit Testing">
<link rel="part" href="gstreamer-libs-hierarchy.html" title="Part&#160;II.&#160;Object Hierarchy">
<link rel="index" href="api-index.html" title="Index">
<link rel="index" href="ix02.html" title="Index of deprecated symbols">
</head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
<table class="navigation" id="top" width="100%" summary="Navigation header" cellpadding="2" cellspacing="2">
<tr valign="middle">
<td><a accesskey="p" href="GstPushSrc.html"><img src="left.png" width="24" height="24" border="0" alt="Prev"></a></td>
<td><a accesskey="u" href="gstreamer-base.html"><img src="up.png" width="24" height="24" border="0" alt="Up"></a></td>
<td><a accesskey="h" href="index.html"><img src="home.png" width="24" height="24" border="0" alt="Home"></a></td>
<th width="100%" align="center">GStreamer 0.10 Library Reference Manual</th>
<td><a accesskey="n" href="GstCollectPads.html"><img src="right.png" width="24" height="24" border="0" alt="Next"></a></td>
</tr>
<tr><td colspan="5" class="shortcuts"><nobr><a href="#id2572752" class="shortcut">Top</a>
                  &#160;|&#160;
                  <a href="#id2573699" class="shortcut">Description</a>
                  &#160;|&#160;
                  <a href="#id2573674" class="shortcut">Object Hierarchy</a></nobr></td></tr>
</table>
<div class="refentry" lang="en">
<a name="GstAdapter"></a><div class="titlepage"></div>
<div class="refnamediv"><table width="100%"><tr>
<td valign="top">
<h2>
<a name="id2572752"></a><span class="refentrytitle">GstAdapter</span>
</h2>
<p>GstAdapter &#8212; adapts incoming data on a sink pad into chunks of N bytes</p>
</td>
<td valign="top" align="right"></td>
</tr></table></div>
<div class="refsynopsisdiv">
<h2>Synopsis</h2>
<pre class="synopsis">

#include &lt;gst/base/gstadapter.h&gt;


                    <a href="GstAdapter.html#GstAdapter-struct">GstAdapter</a>;
<a href="GstAdapter.html" title="GstAdapter">GstAdapter</a>*         <a href="GstAdapter.html#gst-adapter-new">gst_adapter_new</a>                     (void);
void                <a href="GstAdapter.html#gst-adapter-clear">gst_adapter_clear</a>                   (<a href="GstAdapter.html" title="GstAdapter">GstAdapter</a> *adapter);
void                <a href="GstAdapter.html#gst-adapter-push">gst_adapter_push</a>                    (<a href="GstAdapter.html" title="GstAdapter">GstAdapter</a> *adapter,
                                                         GstBuffer *buf);
const guint8*       <a href="GstAdapter.html#gst-adapter-peek">gst_adapter_peek</a>                    (<a href="GstAdapter.html" title="GstAdapter">GstAdapter</a> *adapter,
                                                         guint size);
void                <a href="GstAdapter.html#gst-adapter-copy">gst_adapter_copy</a>                    (<a href="GstAdapter.html" title="GstAdapter">GstAdapter</a> *adapter,
                                                         guint8 *dest,
                                                         guint offset,
                                                         guint size);
void                <a href="GstAdapter.html#gst-adapter-flush">gst_adapter_flush</a>                   (<a href="GstAdapter.html" title="GstAdapter">GstAdapter</a> *adapter,
                                                         guint flush);
guint               <a href="GstAdapter.html#gst-adapter-available">gst_adapter_available</a>               (<a href="GstAdapter.html" title="GstAdapter">GstAdapter</a> *adapter);
guint               <a href="GstAdapter.html#gst-adapter-available-fast">gst_adapter_available_fast</a>          (<a href="GstAdapter.html" title="GstAdapter">GstAdapter</a> *adapter);
guint8*             <a href="GstAdapter.html#gst-adapter-take">gst_adapter_take</a>                    (<a href="GstAdapter.html" title="GstAdapter">GstAdapter</a> *adapter,
                                                         guint nbytes);
GstBuffer*          <a href="GstAdapter.html#gst-adapter-take-buffer">gst_adapter_take_buffer</a>             (<a href="GstAdapter.html" title="GstAdapter">GstAdapter</a> *adapter,
                                                         guint nbytes);


</pre>
</div>
<div class="refsect1" lang="en">
<a name="id2573674"></a><h2>Object Hierarchy</h2>
<pre class="synopsis">

  GObject
   +----GstAdapter
</pre>
</div>
<div class="refsect1" lang="en">
<a name="id2573699"></a><h2>Description</h2>
<p>
This class is for elements that receive buffers in an undesired size.
While for example raw video contains one image per buffer, the same is not
true for a lot of other formats, especially those that come directly from
a file. So if you have undefined buffer sizes and require a specific size,
this object is for you.
</p>
<p>
An adapter is created with <a href="GstAdapter.html#gst-adapter-new"><code class="function">gst_adapter_new()</code></a>. It can be freed again with
<code class="function">g_object_unref()</code>.
</p>
<p>
The theory of operation is like this: All buffers received are put
into the adapter using <a href="GstAdapter.html#gst-adapter-push"><code class="function">gst_adapter_push()</code></a> and the data is then read back
in chunks of the desired size using <a href="GstAdapter.html#gst-adapter-peek"><code class="function">gst_adapter_peek()</code></a>. After the data is
processed, it is freed using <a href="GstAdapter.html#gst-adapter-flush"><code class="function">gst_adapter_flush()</code></a>.
</p>
<p>
For example, a sink pad's chain function that needs to pass data to a library
in 512-byte chunks could be implemented like this:
</p>
<pre class="programlisting">
static GstFlowReturn
sink_pad_chain (GstPad *pad, GstBuffer *buffer)
{
  MyElement *this;
  GstAdapter *adapter;
  GstFlowReturn ret = GST_FLOW_OK;
  
  // will give the element an extra ref; remember to drop it 
  this = MY_ELEMENT (gst_pad_get_parent (pad));
  adapter = this-&gt;adapter;
  
  // put buffer into adapter
  gst_adapter_push (adapter, buffer);
  // while we can read out 512 bytes, process them
  while (gst_adapter_available (adapter) &gt;= 512 &amp;&amp; ret == GST_FLOW_OK) {
    // use flowreturn as an error value
    ret = my_library_foo (gst_adapter_peek (adapter, 512));
    gst_adapter_flush (adapter, 512);
  }
  
  gst_object_unref (this);
  return ret;
}
</pre>
<p>
For another example, a simple element inside GStreamer that uses GstAdapter
is the libvisual element.
</p>
<p>
An element using GstAdapter in its sink pad chain function should ensure that
when the FLUSH_STOP event is received, that any queued data is cleared using
<a href="GstAdapter.html#gst-adapter-clear"><code class="function">gst_adapter_clear()</code></a>. Data should also be cleared or processed on EOS and
when changing state from <span class="type">GST_STATE_PAUSED</span> to <span class="type">GST_STATE_READY</span>.
</p>
<p>
Also check the GST_BUFFER_FLAG_DISCONT flag on the buffer. Some elements might
need to clear the adapter after a discontinuity.
</p>
<p>
A last thing to note is that while GstAdapter is pretty optimized,
merging buffers still might be an operation that requires a <code class="function">memcpy()</code>
operation, and this operation is not the fastest. Because of this, some
functions like <a href="GstAdapter.html#gst-adapter-available-fast"><code class="function">gst_adapter_available_fast()</code></a> are provided to help speed up
such cases should you want to.
</p>
<p>
GstAdapter is not MT safe. All operations on an adapter must be serialized by
the caller. This is not normally a problem, however, as the normal use case
of GstAdapter is inside one pad's chain function, in which case access is
serialized via the pad's STREAM_LOCK.
</p>
<p>
Note that <a href="GstAdapter.html#gst-adapter-push"><code class="function">gst_adapter_push()</code></a> takes ownership of the buffer passed. Use 
<code class="function">gst_buffer_ref()</code> before pushing it into the adapter if you still want to
access the buffer later. The adapter will never modify the data in the
buffer pushed in it.
</p>
<p>
Last reviewed on 2006-04-04 (0.10.6).</p>
<p>

</p>
</div>
<div class="refsect1" lang="en">
<a name="id2573930"></a><h2>Details</h2>
<div class="refsect2" lang="en">
<a name="id2573940"></a><h3>
<a name="GstAdapter-struct"></a>GstAdapter</h3>
<a class="indexterm" name="id2573953"></a><pre class="programlisting">typedef struct _GstAdapter GstAdapter;</pre>
<p>
The opaque <a href="GstAdapter.html" title="GstAdapter"><span class="type">GstAdapter</span></a> data structure.</p>
<p>

</p>
</div>
<hr>
<div class="refsect2" lang="en">
<a name="id2573980"></a><h3>
<a name="gst-adapter-new"></a>gst_adapter_new ()</h3>
<a class="indexterm" name="id2573992"></a><pre class="programlisting"><a href="GstAdapter.html" title="GstAdapter">GstAdapter</a>*         gst_adapter_new                     (void);</pre>
<p>
Creates a new <a href="GstAdapter.html" title="GstAdapter"><span class="type">GstAdapter</span></a>. Free with <code class="function">g_object_unref()</code>.</p>
<p>

</p>
<div class="variablelist"><table border="0">
<col align="left" valign="top">
<tbody><tr>
<td><span class="term"><span class="emphasis"><em>Returns</em></span>&#160;:</span></td>
<td> a new <a href="GstAdapter.html" title="GstAdapter"><span class="type">GstAdapter</span></a>
</td>
</tr></tbody>
</table></div>
</div>
<hr>
<div class="refsect2" lang="en">
<a name="id2574058"></a><h3>
<a name="gst-adapter-clear"></a>gst_adapter_clear ()</h3>
<a class="indexterm" name="id2574071"></a><pre class="programlisting">void                gst_adapter_clear                   (<a href="GstAdapter.html" title="GstAdapter">GstAdapter</a> *adapter);</pre>
<p>
Removes all buffers from <em class="parameter"><code>adapter</code></em>.</p>
<p>

</p>
<div class="variablelist"><table border="0">
<col align="left" valign="top">
<tbody><tr>
<td><span class="term"><em class="parameter"><code>adapter</code></em>&#160;:</span></td>
<td> a <a href="GstAdapter.html" title="GstAdapter"><span class="type">GstAdapter</span></a>
</td>
</tr></tbody>
</table></div>
</div>
<hr>
<div class="refsect2" lang="en">
<a name="id2574134"></a><h3>
<a name="gst-adapter-push"></a>gst_adapter_push ()</h3>
<a class="indexterm" name="id2574146"></a><pre class="programlisting">void                gst_adapter_push                    (<a href="GstAdapter.html" title="GstAdapter">GstAdapter</a> *adapter,
                                                         GstBuffer *buf);</pre>
<p>
Adds the data from <em class="parameter"><code>buf</code></em> to the data stored inside <em class="parameter"><code>adapter</code></em> and takes
ownership of the buffer.</p>
<p>

</p>
<div class="variablelist"><table border="0">
<col align="left" valign="top">
<tbody>
<tr>
<td><span class="term"><em class="parameter"><code>adapter</code></em>&#160;:</span></td>
<td> a <a href="GstAdapter.html" title="GstAdapter"><span class="type">GstAdapter</span></a>
</td>
</tr>
<tr>
<td><span class="term"><em class="parameter"><code>buf</code></em>&#160;:</span></td>
<td> a <span class="type">GstBuffer</span> to add to queue in the adapter
</td>
</tr>
</tbody>
</table></div>
</div>
<hr>
<div class="refsect2" lang="en">
<a name="id2574246"></a><h3>
<a name="gst-adapter-peek"></a>gst_adapter_peek ()</h3>
<a class="indexterm" name="id2574259"></a><pre class="programlisting">const guint8*       gst_adapter_peek                    (<a href="GstAdapter.html" title="GstAdapter">GstAdapter</a> *adapter,
                                                         guint size);</pre>
<p>
Gets the first <em class="parameter"><code>size</code></em> bytes stored in the <em class="parameter"><code>adapter</code></em>. The returned pointer is
valid until the next function is called on the adapter.
</p>
<p>
Note that setting the returned pointer as the data of a <span class="type">GstBuffer</span> is
incorrect for general-purpose plugins. The reason is that if a downstream
element stores the buffer so that it has access to it outside of the bounds
of its chain function, the buffer will have an invalid data pointer after
your element flushes the bytes. In that case you should use
<a href="GstAdapter.html#gst-adapter-take"><code class="function">gst_adapter_take()</code></a>, which returns a freshly-allocated buffer that you can set
as <span class="type">GstBuffer</span> malloc_data or the potentially more performant 
<a href="GstAdapter.html#gst-adapter-take-buffer"><code class="function">gst_adapter_take_buffer()</code></a>.
</p>
<p>
Returns <span class="type">NULL</span> if <em class="parameter"><code>size</code></em> bytes are not available.</p>
<p>

</p>
<div class="variablelist"><table border="0">
<col align="left" valign="top">
<tbody>
<tr>
<td><span class="term"><em class="parameter"><code>adapter</code></em>&#160;:</span></td>
<td> a <a href="GstAdapter.html" title="GstAdapter"><span class="type">GstAdapter</span></a>
</td>
</tr>
<tr>
<td><span class="term"><em class="parameter"><code>size</code></em>&#160;:</span></td>
<td> the number of bytes to peek
</td>
</tr>
<tr>
<td><span class="term"><span class="emphasis"><em>Returns</em></span>&#160;:</span></td>
<td> a pointer to the first <em class="parameter"><code>size</code></em> bytes of data, or NULL.
</td>
</tr>
</tbody>
</table></div>
</div>
<hr>
<div class="refsect2" lang="en">
<a name="id2574437"></a><h3>
<a name="gst-adapter-copy"></a>gst_adapter_copy ()</h3>
<a class="indexterm" name="id2574452"></a><pre class="programlisting">void                gst_adapter_copy                    (<a href="GstAdapter.html" title="GstAdapter">GstAdapter</a> *adapter,
                                                         guint8 *dest,
                                                         guint offset,
                                                         guint size);</pre>
<p>
Copies <em class="parameter"><code>size</code></em> bytes of data starting at <em class="parameter"><code>offset</code></em> out of the buffers
contained in <em class="parameter"><code>GstAdapter</code></em> into an array <em class="parameter"><code>dest</code></em> provided by the caller.
</p>
<p>
The array <em class="parameter"><code>dest</code></em> should be large enough to contain <em class="parameter"><code>size</code></em> bytes.
The user should check that the adapter has (<em class="parameter"><code>offset</code></em> + <em class="parameter"><code>size</code></em>) bytes
available before calling this function.</p>
<p>

</p>
<div class="variablelist"><table border="0">
<col align="left" valign="top">
<tbody>
<tr>
<td><span class="term"><em class="parameter"><code>adapter</code></em>&#160;:</span></td>
<td> a <a href="GstAdapter.html" title="GstAdapter"><span class="type">GstAdapter</span></a>
</td>
</tr>
<tr>
<td><span class="term"><em class="parameter"><code>dest</code></em>&#160;:</span></td>
<td> the memory where to copy to
</td>
</tr>
<tr>
<td><span class="term"><em class="parameter"><code>offset</code></em>&#160;:</span></td>
<td> the bytes offset in the adapter to start from
</td>
</tr>
<tr>
<td><span class="term"><em class="parameter"><code>size</code></em>&#160;:</span></td>
<td> the number of bytes to copy
</td>
</tr>
</tbody>
</table></div>
<p class="since">Since  0.10.12
</p>
</div>
<hr>
<div class="refsect2" lang="en">
<a name="id2574637"></a><h3>
<a name="gst-adapter-flush"></a>gst_adapter_flush ()</h3>
<a class="indexterm" name="id2574650"></a><pre class="programlisting">void                gst_adapter_flush                   (<a href="GstAdapter.html" title="GstAdapter">GstAdapter</a> *adapter,
                                                         guint flush);</pre>
<p>
Flushes the first <em class="parameter"><code>flush</code></em> bytes in the <em class="parameter"><code>adapter</code></em>. The caller must ensure that
at least this many bytes are available.
</p>
<p>
See also: <a href="GstAdapter.html#gst-adapter-peek"><code class="function">gst_adapter_peek()</code></a>.</p>
<p>

</p>
<div class="variablelist"><table border="0">
<col align="left" valign="top">
<tbody>
<tr>
<td><span class="term"><em class="parameter"><code>adapter</code></em>&#160;:</span></td>
<td> a <a href="GstAdapter.html" title="GstAdapter"><span class="type">GstAdapter</span></a>
</td>
</tr>
<tr>
<td><span class="term"><em class="parameter"><code>flush</code></em>&#160;:</span></td>
<td> the number of bytes to flush
</td>
</tr>
</tbody>
</table></div>
</div>
<hr>
<div class="refsect2" lang="en">
<a name="id2574757"></a><h3>
<a name="gst-adapter-available"></a>gst_adapter_available ()</h3>
<a class="indexterm" name="id2574770"></a><pre class="programlisting">guint               gst_adapter_available               (<a href="GstAdapter.html" title="GstAdapter">GstAdapter</a> *adapter);</pre>
<p>
Gets the maximum amount of bytes available, that is it returns the maximum
value that can be supplied to <a href="GstAdapter.html#gst-adapter-peek"><code class="function">gst_adapter_peek()</code></a> without that function
returning NULL.</p>
<p>

</p>
<div class="variablelist"><table border="0">
<col align="left" valign="top">
<tbody>
<tr>
<td><span class="term"><em class="parameter"><code>adapter</code></em>&#160;:</span></td>
<td> a <a href="GstAdapter.html" title="GstAdapter"><span class="type">GstAdapter</span></a>
</td>
</tr>
<tr>
<td><span class="term"><span class="emphasis"><em>Returns</em></span>&#160;:</span></td>
<td> number of bytes available in <em class="parameter"><code>adapter</code></em>
</td>
</tr>
</tbody>
</table></div>
</div>
<hr>
<div class="refsect2" lang="en">
<a name="id2574856"></a><h3>
<a name="gst-adapter-available-fast"></a>gst_adapter_available_fast ()</h3>
<a class="indexterm" name="id2574870"></a><pre class="programlisting">guint               gst_adapter_available_fast          (<a href="GstAdapter.html" title="GstAdapter">GstAdapter</a> *adapter);</pre>
<p>
Gets the maximum number of bytes that are immediately available without
requiring any expensive operations (like copying the data into a 
temporary buffer).</p>
<p>

</p>
<div class="variablelist"><table border="0">
<col align="left" valign="top">
<tbody>
<tr>
<td><span class="term"><em class="parameter"><code>adapter</code></em>&#160;:</span></td>
<td> a <a href="GstAdapter.html" title="GstAdapter"><span class="type">GstAdapter</span></a>
</td>
</tr>
<tr>
<td><span class="term"><span class="emphasis"><em>Returns</em></span>&#160;:</span></td>
<td> number of bytes that are available in <em class="parameter"><code>adapter</code></em> without expensive 
operations
</td>
</tr>
</tbody>
</table></div>
</div>
<hr>
<div class="refsect2" lang="en">
<a name="id2574947"></a><h3>
<a name="gst-adapter-take"></a>gst_adapter_take ()</h3>
<a class="indexterm" name="id2574959"></a><pre class="programlisting">guint8*             gst_adapter_take                    (<a href="GstAdapter.html" title="GstAdapter">GstAdapter</a> *adapter,
                                                         guint nbytes);</pre>
<p>
Returns a freshly allocated buffer containing the first <em class="parameter"><code>nbytes</code></em> bytes of the
<em class="parameter"><code>adapter</code></em>. The returned bytes will be flushed from the adapter.
</p>
<p>
Caller owns returned value. g_free after usage.</p>
<p>

</p>
<div class="variablelist"><table border="0">
<col align="left" valign="top">
<tbody>
<tr>
<td><span class="term"><em class="parameter"><code>adapter</code></em>&#160;:</span></td>
<td> a <a href="GstAdapter.html" title="GstAdapter"><span class="type">GstAdapter</span></a>
</td>
</tr>
<tr>
<td><span class="term"><em class="parameter"><code>nbytes</code></em>&#160;:</span></td>
<td> the number of bytes to take
</td>
</tr>
<tr>
<td><span class="term"><span class="emphasis"><em>Returns</em></span>&#160;:</span></td>
<td> oven-fresh hot data, or <span class="type">NULL</span> if <em class="parameter"><code>nbytes</code></em> bytes are not available
</td>
</tr>
</tbody>
</table></div>
</div>
<hr>
<div class="refsect2" lang="en">
<a name="id2575081"></a><h3>
<a name="gst-adapter-take-buffer"></a>gst_adapter_take_buffer ()</h3>
<a class="indexterm" name="id2575096"></a><pre class="programlisting">GstBuffer*          gst_adapter_take_buffer             (<a href="GstAdapter.html" title="GstAdapter">GstAdapter</a> *adapter,
                                                         guint nbytes);</pre>
<p>
Returns a <span class="type">GstBuffer</span> containing the first <em class="parameter"><code>nbytes</code></em> bytes of the
<em class="parameter"><code>adapter</code></em>. The returned bytes will be flushed from the adapter.
This function is potentially more performant than <a href="GstAdapter.html#gst-adapter-take"><code class="function">gst_adapter_take()</code></a> 
since it can reuse the memory in pushed buffers by subbuffering
or merging.
</p>
<p>
Caller owns returned value. <code class="function">gst_buffer_unref()</code> after usage.</p>
<p>

</p>
<div class="variablelist"><table border="0">
<col align="left" valign="top">
<tbody>
<tr>
<td><span class="term"><em class="parameter"><code>adapter</code></em>&#160;:</span></td>
<td> a <a href="GstAdapter.html" title="GstAdapter"><span class="type">GstAdapter</span></a>
</td>
</tr>
<tr>
<td><span class="term"><em class="parameter"><code>nbytes</code></em>&#160;:</span></td>
<td> the number of bytes to take
</td>
</tr>
<tr>
<td><span class="term"><span class="emphasis"><em>Returns</em></span>&#160;:</span></td>
<td> a <span class="type">GstBuffer</span> containing the first <em class="parameter"><code>nbytes</code></em> of the adapter, 
or <span class="type">NULL</span> if <em class="parameter"><code>nbytes</code></em> bytes are not available
</td>
</tr>
</tbody>
</table></div>
<p class="since">Since  0.10.6

</p>
</div>
</div>
</div>
</body>
</html>
