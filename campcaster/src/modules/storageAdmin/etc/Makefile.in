#-------------------------------------------------------------------------------
#   getID3 - read and writes tags in media files - see getid3.readme.txt
#   getID3 by James Heinrich <getid3@users.sourceforge.net>
#
#   This file is part of the Campcaster project.
#   Copyright (c) 2004 Media Development Loan Fund
#
#   Campcaster is free software; you can redistribute it and/or modify
#   it under the terms of the GNU General Public License as published by
#   the Free Software Foundation; either version 2 of the License, or
#   (at your option) any later version.
#
#   Campcaster is distributed in the hope that it will be useful,
#   but WITHOUT ANY WARRANTY; without even the implied warranty of
#   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
#   GNU General Public License for more details.
#
#   You should have received a copy of the GNU General Public License
#   along with Campcaster; if not, write to the Free Software
#   Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
#
#
#   Author   : Author$
#   Version  : $Revision$
#   Location : $URL$
#
#   @configure_input@
#-------------------------------------------------------------------------------

#-------------------------------------------------------------------------------
#   General command definitions
#-------------------------------------------------------------------------------
SHELL   = /bin/bash
MKDIR   = mkdir -p
RM      = rm -f
RMDIR   = rm -rf
DOXYGEN = doxygen
CP      = cp -f
SED     = sed
ECHO    = echo
CAT     = cat


#-------------------------------------------------------------------------------
#   Misc
#-------------------------------------------------------------------------------

MODULE_NAME = getid3
TAR_C       = tar -cj --exclude .svn --exclude '*~' -C ${BASE_DIR} -f
DIST_EXT    = .tgz
DATE        = `date +%y%m%d`

#-------------------------------------------------------------------------------
#   Basic directory and file definitions
#-------------------------------------------------------------------------------
#BASE_DIR    = @builddir@
BASE_DIR    = .
DOC_DIR     = ${BASE_DIR}/doc
DOXYGEN_DIR = ${DOC_DIR}/doxygen
ETC_DIR     = ${BASE_DIR}/etc
DOXYGEN_CONFIG  = ${ETC_DIR}/doxygen.config
INCLUDE_DIR = ${BASE_DIR}/include
LIB_DIR     = ${BASE_DIR}/lib
SRC_DIR     = ${BASE_DIR}/src
TMP_DIR     = ${BASE_DIR}/tmp
VAR_DIR     = ${BASE_DIR}/var
BIN_DIR     = ${BASE_DIR}/bin

prefix = @prefix@

USR_DIR         = ${prefix}

DEST_DIR    = ${USR_DIR}
PHPPART_DIR = ${prefix}/var/Campcaster/storageAdmin/var
STORAGE_SERVER 	= @STORAGE_SERVER@

PHPPART_DIR_S=$(shell ${ECHO} ${PHPPART_DIR} | ${SED} -e "s/\//\\\\\\\\\//g")
STORAGE_SERVER_S=$(shell ${ECHO} ${STORAGE_SERVER} | ${SED} -e "s/\//\\\\\\\\\//g")

SED_STORAGE_SERVER="s/ls_storageServer/${STORAGE_SERVER_S}/;"
SED_PHPPART_DIR="s/phpdir=ls_storageAdmin_phppart_dir/phpdir=${PHPPART_DIR_S}/;"


#-------------------------------------------------------------------------------
#   Configuration parameters
#-------------------------------------------------------------------------------

#-------------------------------------------------------------------------------
#   Dependencies
#-------------------------------------------------------------------------------
#HELLO_LIB_OBJS = ${TMP_DIR}/Hello.o
#TEST_RUNNER_OBJS = ${TMP_DIR}/HelloTest.o ${TMP_DIR}/TestRunner.o


#-------------------------------------------------------------------------------
#   Targets
#-------------------------------------------------------------------------------
.PHONY: all dir_setup doc clean docclean depclean distclean dist install

all: dir_setup

#dir_setup: ${TMP_DIR} ${DOXYGEN_DIR}
dir_setup: ${DOXYGEN_DIR}

doc:
	${DOXYGEN} ${DOXYGEN_CONFIG}

clean:
#	${RM} ...

docclean:
	${RMDIR} ${DOXYGEN_DIR}/html

depclean: clean

dist: all
	${TAR_C} ${MODULE_NAME}${DATE}${DIST_EXT} *

distclean: clean docclean
#	${RMDIR} ${TMP_DIR}/config* ${TMP_DIR}/autom4te*

check: all

install:
	${MKDIR} ${DEST_DIR}/bin
	${CP} ${BIN_DIR}/campcaster-import \
	      ${BIN_DIR}/campcaster-backup \
	      ${BIN_DIR}/campcaster-restore \
	      ${BIN_DIR}/dumpDbSchema.sh \
	      ${DEST_DIR}/bin
	${SED} -i -e ${SED_PHPPART_DIR} \
	       ${DEST_DIR}/bin/campcaster-backup \
	       ${DEST_DIR}/bin/campcaster-restore \
	       ${DEST_DIR}/bin/dumpDbSchema.sh \
	       ${DEST_DIR}/bin/campcaster-import
	${MKDIR} ${PHPPART_DIR}
	${CP} ${VAR_DIR}/*.php ${PHPPART_DIR}
	${CAT} ${VAR_DIR}/conf.php.template | ${SED} -e ${SED_STORAGE_SERVER} \
	       > ${PHPPART_DIR}/conf.php


#-------------------------------------------------------------------------------
#   Specific targets
#-------------------------------------------------------------------------------
${DOXYGEN_DIR}:
	${MKDIR} ${DOXYGEN_DIR}

#${TEST_RUNNER}:

#-------------------------------------------------------------------------------
#   Pattern rules
#-------------------------------------------------------------------------------
#${TMP_DIR}/%.o : ${SRC_DIR}/%.cxx
#	${CXX} ${CPPFLAGS} ${CXXFLAGS} -c -o $@ $<

